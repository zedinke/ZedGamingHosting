http:
  routers:
    # Frontend - Root domain
    web-http:
      rule: "Host(`zedgaminghosting.hu`) || Host(`www.zedgaminghosting.hu`) || Host(`116.203.226.140`)"
      entryPoints:
        - web
      service: web
      middlewares:
        - redirect-to-https

    web-https:
      rule: "Host(`zedgaminghosting.hu`) || Host(`www.zedgaminghosting.hu`) || Host(`116.203.226.140`)"
      entryPoints:
        - websecure
      service: web
      tls:
        certResolver: letsencrypt
      priority: 1

    # API - /api routes
    api-http:
      rule: "(Host(`zedgaminghosting.hu`) || Host(`www.zedgaminghosting.hu`) || Host(`116.203.226.140`)) && PathPrefix(`/api`)"
      entryPoints:
        - web
      service: api
      middlewares:
        - redirect-to-https

    api-https:
      rule: "(Host(`zedgaminghosting.hu`) || Host(`www.zedgaminghosting.hu`) || Host(`116.203.226.140`)) && PathPrefix(`/api`)"
      entryPoints:
        - websecure
      service: api
      tls:
        certResolver: letsencrypt
      priority: 10

    # Adminer - Database Admin
    adminer-http:
      rule: "(Host(`zedgaminghosting.hu`) || Host(`116.203.226.140`)) && PathPrefix(`/adminer`)"
      entryPoints:
        - web
      service: adminer
      middlewares:
        - redirect-to-https
      priority: 20

    adminer-https:
      rule: "(Host(`zedgaminghosting.hu`) || Host(`116.203.226.140`)) && PathPrefix(`/adminer`)"
      entryPoints:
        - websecure
      service: adminer
      tls:
        certResolver: letsencrypt
      priority: 20

  middlewares:
    redirect-to-https:
      redirectScheme:
        scheme: https
        permanent: true

  services:
    web:
      loadBalancer:
        servers:
          - url: "http://zed-web:3000"

    api:
      loadBalancer:
        servers:
          - url: "http://zed-api:3000"

    adminer:
      loadBalancer:
        servers:
          - url: "http://zed-adminer:8080"
